// This file is automatically generated, so please do not edit it.
// @generated by `flutter_rust_bridge`@ 2.11.1.

// ignore_for_file: invalid_use_of_internal_member, unused_import, unnecessary_import

import '../bridge.dart';
import '../frb_generated.dart';
import '../lib.dart';
import '../types.dart';
import 'package:flutter_rust_bridge/flutter_rust_bridge_for_generated.dart';

// These function are ignored because they are on traits that is not defined in current crate (put an empty `#[frb]` on it to unignore): `clone`, `fmt`, `fmt`

/// 获取 Tokio 运行时的引用（供 bridge 模块使用）
Future<Runtime?> getRuntime() => P2PBridge.instance.api.localp2PFfiGetRuntime();

/// 初始化 P2P 模块
///
/// # Safety
/// 必须在使用任何其他函数之前调用，且只能调用一次
Future<P2PHandle> localp2PInit({
  required ConstCChar deviceName,
  required MutMutCChar errorOut,
}) => P2PBridge.instance.api.localp2PFfiLocalp2PInit(
  deviceName: deviceName,
  errorOut: errorOut,
);

/// 启动 P2P 服务并开始发现节点
///
/// # Safety
/// 必须在 `localp2p_init` 之后调用
Future<P2PErrorCode> localp2PStart({required P2PHandle handle}) =>
    P2PBridge.instance.api.localp2PFfiLocalp2PStart(handle: handle);

/// 停止 P2P 服务
///
/// # Safety
Future<P2PErrorCode> localp2PStop({required P2PHandle handle}) =>
    P2PBridge.instance.api.localp2PFfiLocalp2PStop(handle: handle);

/// 清理资源
///
/// # Safety
Future<void> localp2PCleanup({required P2PHandle handle}) =>
    P2PBridge.instance.api.localp2PFfiLocalp2PCleanup(handle: handle);

/// 获取本地 Peer ID
///
/// # Safety
Future<P2PErrorCode> localp2PGetLocalPeerId({
  required P2PHandle handle,
  required MutCChar out,
  required SizeT outLen,
}) => P2PBridge.instance.api.localp2PFfiLocalp2PGetLocalPeerId(
  handle: handle,
  out: out,
  outLen: outLen,
);

/// 获取设备名称
///
/// # Safety
Future<P2PErrorCode> localp2PGetDeviceName({
  required P2PHandle handle,
  required MutCChar out,
  required SizeT outLen,
}) => P2PBridge.instance.api.localp2PFfiLocalp2PGetDeviceName(
  handle: handle,
  out: out,
  outLen: outLen,
);

/// 获取已验证的节点列表
///
/// # Safety
/// 调用者负责释放返回的数组
Future<P2PErrorCode> localp2PGetVerifiedNodes({
  required P2PHandle handle,
  required MutMutNodeInfo out,
  required MutSizeT outLen,
}) => P2PBridge.instance.api.localp2PFfiLocalp2PGetVerifiedNodes(
  handle: handle,
  out: out,
  outLen: outLen,
);

/// 释放节点列表
///
/// # Safety
Future<void> localp2PFreeNodeList({
  required MutNodeInfo nodes,
  required SizeT len,
}) => P2PBridge.instance.api.localp2PFfiLocalp2PFreeNodeList(
  nodes: nodes,
  len: len,
);

/// 发送消息
///
/// # Safety
Future<P2PErrorCode> localp2PSendMessage({
  required P2PHandle handle,
  required ConstCChar targetPeerId,
  required ConstCChar message,
  required MutMutCChar errorOut,
}) => P2PBridge.instance.api.localp2PFfiLocalp2PSendMessage(
  handle: handle,
  targetPeerId: targetPeerId,
  message: message,
  errorOut: errorOut,
);

/// 广播消息给多个节点
///
/// # Safety
Future<P2PErrorCode> localp2PBroadcastMessage({
  required P2PHandle handle,
  required ConstConstCChar targetPeerIds,
  required SizeT targetCount,
  required ConstCChar message,
  required MutMutCChar errorOut,
}) => P2PBridge.instance.api.localp2PFfiLocalp2PBroadcastMessage(
  handle: handle,
  targetPeerIds: targetPeerIds,
  targetCount: targetCount,
  message: message,
  errorOut: errorOut,
);

/// 释放错误信息字符串
///
/// # Safety
Future<void> localp2PFreeError({required MutCChar error}) =>
    P2PBridge.instance.api.localp2PFfiLocalp2PFreeError(error: error);

/// 内部初始化函数（供 FRB 调用）
Future<void> internalInit({
  required String deviceName,
  required String identityPath,
}) => P2PBridge.instance.api.localp2PFfiInternalInit(
  deviceName: deviceName,
  identityPath: identityPath,
);

/// 内部启动函数（供 FRB 调用）
Future<void> internalStart() =>
    P2PBridge.instance.api.localp2PFfiInternalStart();

/// 获取事件接收器（供 FRB stream 使用）
Future<UnboundedReceiverP2PEvent> getEventReceiver() =>
    P2PBridge.instance.api.localp2PFfiGetEventReceiver();

/// 内部停止函数
Future<void> internalStop() => P2PBridge.instance.api.localp2PFfiInternalStop();

/// 内部清理函数
Future<void> internalCleanup() =>
    P2PBridge.instance.api.localp2PFfiInternalCleanup();

/// 检查 P2P 是否已初始化
Future<bool> internalIsInitialized() =>
    P2PBridge.instance.api.localp2PFfiInternalIsInitialized();

/// 检查 P2P 服务是否正在运行
Future<bool> internalIsRunning() =>
    P2PBridge.instance.api.localp2PFfiInternalIsRunning();

/// 获取本地 Peer ID
Future<String> internalGetLocalPeerId() =>
    P2PBridge.instance.api.localp2PFfiInternalGetLocalPeerId();

/// 获取设备名称
Future<String> internalGetDeviceName() =>
    P2PBridge.instance.api.localp2PFfiInternalGetDeviceName();

/// 获取已验证的节点列表
///
/// 注意：这是一个同步函数，因为需要在内部使用 block_on
/// 调用此函数需要 tokio::task::spawn_blocking
Future<List<P2PBridgeNodeInfo>> internalGetNodesSync() =>
    P2PBridge.instance.api.localp2PFfiInternalGetNodesSync();

/// 获取已验证的节点列表（async 包装器）
Future<List<P2PBridgeNodeInfo>> internalGetNodes() =>
    P2PBridge.instance.api.localp2PFfiInternalGetNodes();

/// 获取指定节点的用户信息
Future<P2PBridgeNodeInfo?> internalGetUserInfo({required String peerId}) =>
    P2PBridge.instance.api.localp2PFfiInternalGetUserInfo(peerId: peerId);

/// 获取所有节点的用户信息
Future<List<P2PBridgeNodeInfo>> internalListUserInfo() =>
    P2PBridge.instance.api.localp2PFfiInternalListUserInfo();

/// 发送消息
Future<void> internalSendMessage({
  required String targetPeerId,
  required String message,
}) => P2PBridge.instance.api.localp2PFfiInternalSendMessage(
  targetPeerId: targetPeerId,
  message: message,
);

/// 广播消息
Future<void> internalBroadcastMessage({
  required List<String> targetPeerIds,
  required String message,
}) => P2PBridge.instance.api.localp2PFfiInternalBroadcastMessage(
  targetPeerIds: targetPeerIds,
  message: message,
);

/// 设置事件流接收器（用于 Stream 模式）
///
/// 这个函数会保存 StreamSink，之后的 P2P 事件会通过它推送到 Flutter
Stream<P2PEvent> setEventStreamSink() =>
    P2PBridge.instance.api.localp2PFfiSetEventStreamSink();

/// 轮询事件（返回所有待处理的事件并清空队列）
Future<List<P2PEvent>> pollEvents() =>
    P2PBridge.instance.api.localp2PFfiPollEvents();

/// 获取下一个事件（阻塞式）
/// Flutter 可以在一个单独的 isolate 中轮询调用这个函数
Future<P2PEvent?> getNextEvent() =>
    P2PBridge.instance.api.localp2PFfiGetNextEvent();

// Rust type: RustOpaqueMoi<flutter_rust_bridge::for_generated::RustAutoOpaqueInner<Runtime>>
abstract class Runtime implements RustOpaqueInterface {}

// Rust type: RustOpaqueMoi<flutter_rust_bridge::for_generated::RustAutoOpaqueInner< UnboundedReceiver < P2PEvent >>>
abstract class UnboundedReceiverP2PEvent implements RustOpaqueInterface {}

// Rust type: RustOpaqueMoi<flutter_rust_bridge::for_generated::RustAutoOpaqueInner<* const * const c_char>>
abstract class ConstConstCChar implements RustOpaqueInterface {}

// Rust type: RustOpaqueMoi<flutter_rust_bridge::for_generated::RustAutoOpaqueInner<* mut NodeInfo>>
abstract class MutNodeInfo implements RustOpaqueInterface {}

// Rust type: RustOpaqueMoi<flutter_rust_bridge::for_generated::RustAutoOpaqueInner<* mut * mut NodeInfo>>
abstract class MutMutNodeInfo implements RustOpaqueInterface {}

// Rust type: RustOpaqueMoi<flutter_rust_bridge::for_generated::RustAutoOpaqueInner<* mut size_t>>
abstract class MutSizeT implements RustOpaqueInterface {}
